(function(e,n){"object"===typeof exports&&"object"===typeof module?module.exports=n(require("vue")):"function"===typeof define&&define.amd?define([],n):"object"===typeof exports?exports["vue3-update-listener"]=n(require("vue")):e["vue3-update-listener"]=n(e["Vue"])})("undefined"!==typeof self?self:this,(function(e){return function(){"use strict";var n={868:function(e,n){n.A=(e,n)=>{const t=e.__vccOpts||e;for(const[o,c]of n)t[o]=c;return t}},274:function(n){n.exports=e}},t={};function o(e){var c=t[e];if(void 0!==c)return c.exports;var r=t[e]={exports:{}};return n[e](r,r.exports,o),r.exports}!function(){o.d=function(e,n){for(var t in n)o.o(n,t)&&!o.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})}}(),function(){o.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)}}(),function(){o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){o.p=""}();var c={};return function(){if(o.r(c),o.d(c,{default:function(){return H}}),"undefined"!==typeof window){var e=window.document.currentScript,n=e&&e.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);n&&(o.p=n[1])}var t=o(274);function r(e,n,o){return(c,r=!0)=>new Promise(((i,a)=>{const l=Object.assign({},n,c),s=(0,t.createVNode)(e,{...l,onCancel:d(a),onConfirm:f(i,r)},null);o||(o=document.body),(0,t.render)(s,o);const m=document.querySelector(".confirm-mask.update-confirm-loader");function d(){return function(e){m&&m.remove(),a(e)}}function f(){return function(e){r&&m&&m.remove(),i(e,this)}}}))}function i(e,n,o,c,r,i){return(0,t.openBlock)(),(0,t.createBlock)((0,t.resolveDynamicComponent)(r.confirmTypeNames[e.type]),{content:e.content,onConfirm:e.confirm,onCancel:e.cancel},null,40,["content","onConfirm","onCancel"])}const a={class:"confirm-qingmu__body"},l={class:"confirm-qingmu__wrapper"},s=(0,t.createElementVNode)("div",{class:"confirm-qingmu__title"}," 新版上线啦！ ",-1),m={class:"confirm-qingmu__content"},d={class:"confirm-qingmu__desc"},f={class:"confirm-qingmu__footer"},u=(0,t.createElementVNode)("span",null,"暂不更新",-1),p=[u];function v(e,n,o,c,r,i){const u=(0,t.resolveComponent)("ConfirmMask");return(0,t.openBlock)(),(0,t.createBlock)(u,null,{default:(0,t.withCtx)((()=>[(0,t.createElementVNode)("div",a,[(0,t.createElementVNode)("div",l,[s,(0,t.createElementVNode)("div",m,[(0,t.createElementVNode)("div",d,(0,t.toDisplayString)(e.content),1)]),(0,t.createElementVNode)("div",f,[(0,t.createElementVNode)("div",{class:"confirm-qingmu__btn confirm-qingmu__btn--confirm",onClick:n[0]||(n[0]=(...n)=>e.confirm&&e.confirm(...n))}," 立即更新 "),(0,t.createElementVNode)("div",{class:"confirm-qingmu__btn confirm-qingmu__btn--cancel",onClick:n[1]||(n[1]=(...n)=>e.cancel&&e.cancel(...n))},p)])])])])),_:1})}const _={class:"confirm-mask update-confirm-loader"};function y(e,n){return(0,t.openBlock)(),(0,t.createElementBlock)("div",_,[(0,t.renderSlot)(e.$slots,"default")])}var g=o(868);const C={},E=(0,g.A)(C,[["render",y]]);var w=E,b={components:{ConfirmMask:w},props:{content:{type:String,default:""},type:{type:String,default:"qingmu"}},methods:{cancel(){this.$emit("cancel")},confirm(){this.$emit("confirm")}}},N={name:"UpdateConfirmQingmu",mixins:[b]};const h=(0,g.A)(N,[["render",v]]);var V=h;const k={class:"confirm-element__wrapper"},q={class:"confirm-element__header"},S=(0,t.createElementVNode)("div",{class:"confirm-element__title"}," 提示 ",-1),x={class:"confirm-element__content"},j={class:"confirm-element__desc"},P={class:"confirm-element__btns"};function T(e,n,o,c,r,i){const a=(0,t.resolveComponent)("ConfirmMask");return(0,t.openBlock)(),(0,t.createBlock)(a,null,{default:(0,t.withCtx)((()=>[(0,t.createElementVNode)("div",k,[(0,t.createElementVNode)("div",q,[S,(0,t.createElementVNode)("div",{class:"confirm-element__close",onClick:n[0]||(n[0]=(...n)=>e.cancel&&e.cancel(...n))}," × ")]),(0,t.createElementVNode)("div",x,[(0,t.createElementVNode)("div",j,(0,t.toDisplayString)(e.content),1)]),(0,t.createElementVNode)("div",P,[(0,t.createElementVNode)("div",{class:"confirm-element__btn confirm-element__btn--default",onClick:n[1]||(n[1]=(...n)=>e.cancel&&e.cancel(...n))}," 取消 "),(0,t.createElementVNode)("div",{class:"confirm-element__btn confirm-element__btn--primary",onClick:n[2]||(n[2]=(...n)=>e.confirm&&e.confirm(...n))}," 确定 ")])])])),_:1})}var B={name:"UpdateConfirmElement",mixins:[b]};const U=(0,g.A)(B,[["render",T]]);var O=U,A={name:"UpdateConfirm",components:{UpdateConfirmQingmu:V,UpdateConfirmElement:O},mixins:[b],data(){return{confirmTypeNames:{qingmu:"UpdateConfirmQingmu",element:"UpdateConfirmElement"}}}};const M=(0,g.A)(A,[["render",i]]);var $=M;async function D(e,n){return r($,e,n)()}const I={install(e,n){let t,o,c=!1,r=!1;const i=async()=>fetch(`${n.versionUrl||"/dist"}/version.json?timeStamp=`+Date.now()).then((e=>e.json())).catch((e=>{console.warn("获取version.json文件失败，请检查路径是否正确"),r=!0})),a=async()=>{const e=(await i()).commitHash;return e!==t},l=()=>{o&&(console.log("停止检查更新"),clearInterval(o),o="")},s=async()=>{if(!n.showTest&&(!1===n.isTip||r))return;const e=await i();e&&!c&&(t=e.commitHash,console.log("开始检查更新"),o=setInterval((async()=>{c=n.showTest||await a(),(c&&e.isTip||n.showTest)&&(console.log("有新版本"),l(),await m())}),n.interval||3e5))},m=async()=>{try{const e=n.modalProps&&n.modalProps.content;await D({content:e?n.modalProps.content:"为了更好的版本体验请更新到最新版本",type:n.type||"qingmu"},n.modalProps&&n.modalProps.mountedEl),window.location.reload()}catch(e){console.log(e)}},d=()=>{document.hidden?l():s()};document.addEventListener("visibilitychange",d);const f=async e=>{"SCRIPT"===e.target.nodeName&&(l(),await m())};n.isListenJSError&&window.addEventListener("error",f),s()}};var L=I,Q=L,H=Q}(),c}()}));
//# sourceMappingURL=vue3-update-listener.umd.min.js.map