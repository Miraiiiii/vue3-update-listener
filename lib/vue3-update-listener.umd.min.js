(function(e,n){"object"===typeof exports&&"object"===typeof module?module.exports=n(require("vue")):"function"===typeof define&&define.amd?define("vue3-update-listener",[],n):"object"===typeof exports?exports["vue3-update-listener"]=n(require("vue")):e["vue3-update-listener"]=n(e["Vue"])})(this,(function(e){return function(){"use strict";var n={868:function(e,n){n.A=(e,n)=>{const t=e.__vccOpts||e;for(const[o,r]of n)t[o]=r;return t}},274:function(n){n.exports=e}},t={};function o(e){var r=t[e];if(void 0!==r)return r.exports;var c=t[e]={exports:{}};return n[e](c,c.exports,o),c.exports}!function(){o.d=function(e,n){for(var t in n)o.o(n,t)&&!o.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})}}(),function(){o.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)}}(),function(){o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){o.p=""}();var r={};return function(){if(o.r(r),o.d(r,{default:function(){return H}}),"undefined"!==typeof window){var e=window.document.currentScript,n=e&&e.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);n&&(o.p=n[1])}var t=o(274);function c(e,n,o){return(r,c=!0)=>new Promise(((i,a)=>{const l=Object.assign({},n,r),s=(0,t.createVNode)(e,{...l,onCancel:d(a),onConfirm:f(i,c)},null);o||(o=document.body),(0,t.render)(s,o);const m=document.querySelector(".confirm-mask.update-confirm-loader");function d(){return function(e){m&&m.remove(),a(e)}}function f(){return function(e){c&&m&&m.remove(),i(e,this)}}}))}function i(e,n,o,r,c,i){return(0,t.openBlock)(),(0,t.createBlock)((0,t.resolveDynamicComponent)(c.confirmTypeNames[e.type]),{content:e.content,onConfirm:e.confirm,onCancel:e.cancel},null,40,["content","onConfirm","onCancel"])}const a={class:"confirm-qingmu__body"},l={class:"confirm-qingmu__wrapper"},s=(0,t.createElementVNode)("div",{class:"confirm-qingmu__title"}," 新版上线啦！ ",-1),m={class:"confirm-qingmu__content"},d={class:"confirm-qingmu__desc"},f={class:"confirm-qingmu__footer"},u=(0,t.createElementVNode)("span",null,"暂不更新",-1),p=[u];function v(e,n,o,r,c,i){const u=(0,t.resolveComponent)("ConfirmMask");return(0,t.openBlock)(),(0,t.createBlock)(u,null,{default:(0,t.withCtx)((()=>[(0,t.createElementVNode)("div",a,[(0,t.createElementVNode)("div",l,[s,(0,t.createElementVNode)("div",m,[(0,t.createElementVNode)("div",d,(0,t.toDisplayString)(e.content),1)]),(0,t.createElementVNode)("div",f,[(0,t.createElementVNode)("div",{class:"confirm-qingmu__btn confirm-qingmu__btn--confirm",onClick:n[0]||(n[0]=(...n)=>e.confirm&&e.confirm(...n))}," 立即更新 "),(0,t.createElementVNode)("div",{class:"confirm-qingmu__btn confirm-qingmu__btn--cancel",onClick:n[1]||(n[1]=(...n)=>e.cancel&&e.cancel(...n))},p)])])])])),_:1})}const _={class:"confirm-mask update-confirm-loader"};function g(e,n){return(0,t.openBlock)(),(0,t.createElementBlock)("div",_,[(0,t.renderSlot)(e.$slots,"default")])}var y=o(868);const w={},C=(0,y.A)(w,[["render",g]]);var E=C,h={components:{ConfirmMask:E},props:{content:{type:String,default:""},type:{type:String,default:"qingmu"}},methods:{cancel(){this.$emit("cancel")},confirm(){this.$emit("confirm")}}},b={name:"UpdateConfirmQingmu",mixins:[h]};const N=(0,y.A)(b,[["render",v]]);var V=N;const k={class:"confirm-element__wrapper"},S={class:"confirm-element__header"},q=(0,t.createElementVNode)("div",{class:"confirm-element__title"}," 提示 ",-1),x={class:"confirm-element__content"},P={class:"confirm-element__desc"},j={class:"confirm-element__btns"};function T(e,n,o,r,c,i){const a=(0,t.resolveComponent)("ConfirmMask");return(0,t.openBlock)(),(0,t.createBlock)(a,null,{default:(0,t.withCtx)((()=>[(0,t.createElementVNode)("div",k,[(0,t.createElementVNode)("div",S,[q,(0,t.createElementVNode)("div",{class:"confirm-element__close",onClick:n[0]||(n[0]=(...n)=>e.cancel&&e.cancel(...n))}," × ")]),(0,t.createElementVNode)("div",x,[(0,t.createElementVNode)("div",P,(0,t.toDisplayString)(e.content),1)]),(0,t.createElementVNode)("div",j,[(0,t.createElementVNode)("div",{class:"confirm-element__btn confirm-element__btn--default",onClick:n[1]||(n[1]=(...n)=>e.cancel&&e.cancel(...n))}," 取消 "),(0,t.createElementVNode)("div",{class:"confirm-element__btn confirm-element__btn--primary",onClick:n[2]||(n[2]=(...n)=>e.confirm&&e.confirm(...n))}," 确定 ")])])])),_:1})}var O={name:"UpdateConfirmElement",mixins:[h]};const B=(0,y.A)(O,[["render",T]]);var U=B,A={name:"UpdateConfirm",components:{UpdateConfirmQingmu:V,UpdateConfirmElement:U},mixins:[h],data(){return{confirmTypeNames:{qingmu:"UpdateConfirmQingmu",element:"UpdateConfirmElement"}}}};const I=(0,y.A)(A,[["render",i]]);var M=I;async function $(e,n){return c(M,e,n)()}const D={install(e,n){let t,o,r=!1,c=!1;n.refreshSameOrigin&&window.addEventListener("storage",(function(e){"refreshPage"===e.key&&"true"===e.newValue&&(localStorage.removeItem("refreshPage"),window.location.reload())}));const i=async()=>fetch(`${n.versionUrl||"/dist"}/version.json?timeStamp=`+Date.now()).then((e=>e.json())).catch((e=>{console.warn("获取version.json文件失败，请检查路径是否正确"),c=!0})),a=async()=>{const e=(await i()).commitHash;return console.log("当前版本：",e),e!==t},l=()=>{o&&(console.log("停止检查更新"),clearInterval(o),o="")},s=async e=>{r=n.showTest||await a(),(r&&e.isTip||n.showTest)&&(console.log("有新版本"),l(),await d())},m=async(e=!1)=>{if(!n.showTest&&(!1===n.isTip||c))return;const a=await i();a&&!r&&(e||(t=a.commitHash,console.log("当前版本：",t)),e&&await s(a),console.log("开始检查更新"),o=setInterval((async()=>await s(a)),n.interval||3e5))},d=async()=>{try{const e=n.modalProps&&n.modalProps.content;await $({content:e?n.modalProps.content:"为了更好的版本体验请更新到最新版本",type:n.type||"qingmu"},n.modalProps&&n.modalProps.mountedEl),n.refreshSameOrigin?(localStorage.setItem("refreshPage","true"),window.location.reload()):window.location.reload()}catch(e){console.log(e)}},f=()=>{document.hidden?l():m(!0)};document.addEventListener("visibilitychange",f);const u=async e=>{if(e.target&&"SCRIPT"===e.target.nodeName){const n=e.target.src;console.error("Failed to load script: "+n),l(),await d()}};n.isListenJSError&&window.addEventListener("error",u),m()}};var L=D,Q=L,H=Q}(),r}()}));
//# sourceMappingURL=vue3-update-listener.umd.min.js.map