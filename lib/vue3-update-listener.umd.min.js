(function(e,n){"object"===typeof exports&&"object"===typeof module?module.exports=n(require("vue")):"function"===typeof define&&define.amd?define("vue3-update-listener",[],n):"object"===typeof exports?exports["vue3-update-listener"]=n(require("vue")):e["vue3-update-listener"]=n(e["Vue"])})(this,(function(e){return function(){"use strict";var n={868:function(e,n){n.A=(e,n)=>{const t=e.__vccOpts||e;for(const[o,r]of n)t[o]=r;return t}},274:function(n){n.exports=e}},t={};function o(e){var r=t[e];if(void 0!==r)return r.exports;var c=t[e]={exports:{}};return n[e](c,c.exports,o),c.exports}!function(){o.d=function(e,n){for(var t in n)o.o(n,t)&&!o.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})}}(),function(){o.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)}}(),function(){o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){o.p=""}();var r={};return function(){if(o.r(r),o.d(r,{default:function(){return Q}}),"undefined"!==typeof window){var e=window.document.currentScript,n=e&&e.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);n&&(o.p=n[1])}var t=o(274);function c(){let e=0;const n=document.getElementsByTagName("*");for(let t=0;t<n.length;t++){const o=window.getComputedStyle(n[t]).zIndex;isNaN(o)||(e=Math.max(e,parseInt(o,10)))}return e||2001}function i(e,n,o){return(r,i=!0)=>new Promise(((a,m)=>{const s=Object.assign({},n,r),l=c(),d=(0,t.createVNode)(e,{...s,zIndex:l,onCancel:u(m),onConfirm:p(a,i)},null);o||(o=document.body),(0,t.render)(d,o);const f=document.querySelector(".confirm-mask.update-confirm-loader");function u(){return function(e){f&&f.remove(),m(e)}}function p(){return function(e){i&&f&&f.remove(),a(e,this)}}}))}function a(e,n,o,r,c,i){return(0,t.openBlock)(),(0,t.createBlock)((0,t.resolveDynamicComponent)(c.confirmTypeNames[e.type]),{content:e.content,onConfirm:e.confirm,onCancel:e.cancel},null,40,["content","onConfirm","onCancel"])}const m={class:"confirm-qingmu__body"},s={class:"confirm-qingmu__wrapper"},l=(0,t.createElementVNode)("div",{class:"confirm-qingmu__title"}," 新版上线啦！ ",-1),d={class:"confirm-qingmu__content"},f={class:"confirm-qingmu__desc"},u={class:"confirm-qingmu__footer"},p=(0,t.createElementVNode)("span",null,"暂不更新",-1),v=[p];function _(e,n,o,r,c,i){const a=(0,t.resolveComponent)("ConfirmMask");return(0,t.openBlock)(),(0,t.createBlock)(a,{"z-index":e.zIndex},{default:(0,t.withCtx)((()=>[(0,t.createElementVNode)("div",m,[(0,t.createElementVNode)("div",s,[l,(0,t.createElementVNode)("div",d,[(0,t.createElementVNode)("div",f,(0,t.toDisplayString)(e.content),1)]),(0,t.createElementVNode)("div",u,[(0,t.createElementVNode)("div",{class:"confirm-qingmu__btn confirm-qingmu__btn--confirm",onClick:n[0]||(n[0]=(...n)=>e.confirm&&e.confirm(...n))}," 立即更新 "),(0,t.createElementVNode)("div",{class:"confirm-qingmu__btn confirm-qingmu__btn--cancel",onClick:n[1]||(n[1]=(...n)=>e.cancel&&e.cancel(...n))},v)])])])])),_:1},8,["z-index"])}function g(e,n,o,r,c,i){return(0,t.openBlock)(),(0,t.createElementBlock)("div",{class:"confirm-mask update-confirm-loader",style:(0,t.normalizeStyle)({zIndex:o.zIndex})},[(0,t.renderSlot)(e.$slots,"default")],4)}var y={props:{zIndex:{type:Number,default:2001}}},w=o(868);const h=(0,w.A)(y,[["render",g]]);var x=h,C={components:{ConfirmMask:x},props:{content:{type:String,default:""},type:{type:String,default:"qingmu"},zIndex:{type:Number,default:2001}},methods:{cancel(){this.$emit("cancel")},confirm(){this.$emit("confirm")}}},E={name:"UpdateConfirmQingmu",mixins:[C]};const N=(0,w.A)(E,[["render",_]]);var b=N;const S={class:"confirm-element__wrapper"},k={class:"confirm-element__header"},V=(0,t.createElementVNode)("div",{class:"confirm-element__title"}," 提示 ",-1),q={class:"confirm-element__content"},I={class:"confirm-element__desc"},P={class:"confirm-element__btns"};function z(e,n,o,r,c,i){const a=(0,t.resolveComponent)("ConfirmMask");return(0,t.openBlock)(),(0,t.createBlock)(a,{"z-index":e.zIndex},{default:(0,t.withCtx)((()=>[(0,t.createElementVNode)("div",S,[(0,t.createElementVNode)("div",k,[V,(0,t.createElementVNode)("div",{class:"confirm-element__close",onClick:n[0]||(n[0]=(...n)=>e.cancel&&e.cancel(...n))}," × ")]),(0,t.createElementVNode)("div",q,[(0,t.createElementVNode)("div",I,(0,t.toDisplayString)(e.content),1)]),(0,t.createElementVNode)("div",P,[(0,t.createElementVNode)("div",{class:"confirm-element__btn confirm-element__btn--default",onClick:n[1]||(n[1]=(...n)=>e.cancel&&e.cancel(...n))}," 取消 "),(0,t.createElementVNode)("div",{class:"confirm-element__btn confirm-element__btn--primary",onClick:n[2]||(n[2]=(...n)=>e.confirm&&e.confirm(...n))}," 确定 ")])])])),_:1},8,["z-index"])}var T={name:"UpdateConfirmElement",mixins:[C]};const j=(0,w.A)(T,[["render",z]]);var B=j,O={name:"UpdateConfirm",components:{UpdateConfirmQingmu:b,UpdateConfirmElement:B},mixins:[C],data(){return{confirmTypeNames:{qingmu:"UpdateConfirmQingmu",element:"UpdateConfirmElement"}}}};const U=(0,w.A)(O,[["render",a]]);var M=U;async function A(e,n){return i(M,e,n)()}const $={install(e,n){let t,o,r,c=!1,i=!1;n.refreshSameOrigin&&(localStorage.removeItem("refreshPage"),window.addEventListener("storage",(function(e){"refreshPage"===e.key&&"true"===e.newValue&&(localStorage.removeItem("refreshPage"),window.location.reload())})));const a=async()=>fetch(`${n.versionUrl||"/dist"}/version.json?timeStamp=`+Date.now()).then((e=>e.json())).catch((e=>{i=!0})),m=async()=>{const e=await a(),n=e.commitHash;return o=n,n!==t&&e.isTip},s=()=>{r&&(clearInterval(r),r="")},l=async()=>{s(),c=n.showTest||await m(),c||n.showTest?(s(),await u()):f()},d=async(e=!1)=>{if(n.showTest||!1!==n.isTip&&!i)if(e)await l();else{const e=await a();if(!e||c)return;t=e.commitHash,o=t,f()}},f=()=>{r=setInterval(l,n.interval||3e5)},u=async()=>{try{const e=document.querySelector(".confirm-mask.update-confirm-loader");if(e)return;const t=n.modalProps&&n.modalProps.content;await A({content:t?n.modalProps.content:"为了更好的版本体验请更新到最新版本",type:n.type||"qingmu"},n.modalProps&&n.modalProps.mountedEl),n.refreshSameOrigin?(localStorage.setItem("refreshPage","true"),window.location.reload()):window.location.reload()}catch(e){t=o}},p=()=>{document.hidden?s():d(!0)};document.addEventListener("visibilitychange",p);const v=async e=>{if(e.target&&"SCRIPT"===e.target.nodeName&&n.isTip){e.target.src;e.message&&e.message.includes("unexpected token")&&(s(),await u())}};n.isListenJSError&&window.addEventListener("error",v),d()}};var D=$,L=D,Q=L}(),r}()}));